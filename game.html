<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Calculator with History</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f5f5f5;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        .calculator-container {
            display: flex;
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            overflow: hidden; /* Ensure sidebar overflow is hidden */
            position: relative;
            max-width: 100%;
            min-height: 80vh;
            width: 80%;
        }
        .calculator {
            margin-right: 20px;
            width: 100%;
            max-width: 400px;
        }
        #display {
            width: 100%;
            padding: 10px;
            font-size: 1.5em;
            text-align: right;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .keys {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }
        .keys button {
            padding: 15px;
            font-size: 1.2em;
            border: none;
            background: #e0e0e0;
            cursor: pointer;
            border-radius: 5px;
        }
        .keys button.operator {
            background: #ff9800;
            color: #fff;
        }
        .keys button.special {
            background: #9c27b0;
            color: #fff;
        }
        .keys button.memory {
            background: #4caf50;
            color: #fff;
        }
        .keys button#clear, .keys button#delete {
            background: #f44336;
            color: #fff;
        }
        .keys button#calculate {
            background: #2196f3;
            color: #fff;
            grid-column: span 2;
        }
        .history-container {
            position: absolute;
            top: 0;
            right: -320px; /* Initially off-screen */
            width: 300px; /* Sidebar width */
            height: 100%;
            background: #f0f0f0;
            border-radius: 10px 0 0 10px;
            transition: right 0.3s ease; /* Smooth transition */
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            padding: 20px;
            z-index: 1000;
        }
        .history-container.open {
            right: 0; /* Slide in when open */
        }
        .history {
            display: none; /* Initially hidden on small screens */
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: #2196f3;
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        .history.open {
            display: block; /* Show on small screens */
        }
        .history-icon {
            font-size: 1.2em;
        }
        .history-content {
            margin-top: 10px;
        }
        .history h2 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .history-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .history-list li {
            background: #ffffff;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            word-wrap: break-word;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator">
            <input type="text" id="display" readonly>
            <div class="keys">
                <button class="operator">+</button>
                <button class="operator">-</button>
                <button class="operator">*</button>
                <button class="operator">/</button>
                <button class="special">√</button>
                <button class="special">%</button>
                <button class="special">sin</button>
                <button class="special">cos</button>
                <button class="special">tan</button>
                <button class="special">log</button>
                <button class="special">ln</button>
                <button class="special">x!</button>
                <button class="memory">M+</button>
                <button class="memory">M-</button>
                <button class="memory">MR</button>
                <button class="memory">MC</button>
                <button id="clear">C</button>
                <button id="delete">⌫</button>
                <button>7</button>
                <button>8</button>
                <button>9</button>
                <button>4</button>
                <button>5</button>
                <button>6</button>
                <button>1</button>
                <button>2</button>
                <button>3</button>
                <button>0</button>
                <button class="decimal">.</button>
                <button id="calculate">=</button>
            </div>
        </div>
        <div class="history-container" id="history-container">
            <h2>History</h2>
            <ul class="history-list" id="history-list"></ul>
            <div class="history-content">
                <button class="history" id="toggle-history">
                    <span class="history-icon">-</span>
                </button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const display = document.getElementById('display');
            const keys = document.querySelector('.keys');
            const historyContainer = document.getElementById('history-container');
            const historyList = document.getElementById('history-list');
            const toggleHistoryBtn = document.getElementById('toggle-history');
            let currentInput = '0';
            let firstOperand = null;
            let operator = null;
            let awaitingNextInput = false;
            let memory = 0;
            let historyData = [];

            function inputDigit(digit) {
                if (awaitingNextInput) {
                    currentInput = digit;
                    awaitingNextInput = false;
                } else {
                    currentInput = currentInput === '0' ? digit : currentInput + digit;
                }
            }

            function inputDecimal() {
                if (!currentInput.includes('.')) {
                    currentInput += '.';
                }
            }

            function deleteLastDigit() {
                currentInput = currentInput.slice(0, -1) || '0';
            }

            function handleOperator(nextOperator) {
                const inputValue = parseFloat(currentInput);
                if (operator && awaitingNextInput) {
                    operator = nextOperator;
                    return;
                }
                if (firstOperand === null) {
                    firstOperand = inputValue;
                } else if (operator) {
                    const result = performCalculation[operator](firstOperand, inputValue);
                    addToHistory(`${firstOperand} ${operator} ${inputValue} = ${result}`);
                    currentInput = String(result);
                    firstOperand = result;
                }
                operator = nextOperator;
                awaitingNextInput = true;
            }

            const performCalculation = {
                '+': (firstOperand, secondOperand) => firstOperand + secondOperand,
                '-': (firstOperand, secondOperand) => firstOperand - secondOperand,
                '*': (firstOperand, secondOperand) => firstOperand * secondOperand,
                '/': (firstOperand, secondOperand) => firstOperand / secondOperand,
                '√': (firstOperand) => Math.sqrt(firstOperand),
                '%': (firstOperand, secondOperand) => (firstOperand * secondOperand) / 100,
                '=': (firstOperand, secondOperand) => secondOperand,
                'sin': (firstOperand) => Math.sin(firstOperand),
                'cos': (firstOperand) => Math.cos(firstOperand),
                'tan': (firstOperand) => Math.tan(firstOperand),
                'log': (firstOperand) => Math.log10(firstOperand),
                'ln': (firstOperand) => Math.log(firstOperand),
                'x!': (num) => {
                    if (num === 0 || num === 1) {
                        return 1;
                    }
                    let result = 1;
                    for (let i = 2; i <= num; i++) {
                        result *= i;
                    }
                    return result;
                }
            };

            function addToHistory(entry) {
                historyData.push(entry);
                localStorage.setItem('calculatorHistory', JSON.stringify(historyData));
                updateHistory();
            }

            function loadHistory() {
                const storedHistory = JSON.parse(localStorage.getItem('calculatorHistory'));
                if (storedHistory) {
                    historyData = storedHistory;
                    updateHistory();
                }
            }

            function updateHistory() {
                historyList.innerHTML = historyData.map(entry => `<li>${entry}</li>`).join('');
            }

            function clearHistory() {
                historyData = [];
                localStorage.removeItem('calculatorHistory');
                updateHistory();
            }

            function toggleHistory() {
                historyContainer.classList.toggle('open');
                const isOpen = historyContainer.classList.contains('open');
                toggleHistoryBtn.innerHTML = isOpen ? '<span class="history-icon">-</span>' : '<span class="history-icon">+</span>';
            }

            keys.addEventListener('click', (event) => {
                const { target } = event;
                if (!target.matches('button')) {
                    return;
                }

                if (target.classList.contains('operator') || target.classList.contains('special') || target.classList.contains('memory')) {
                    handleOperator(target.textContent);
                } else if (target.id === 'clear') {
                    currentInput = '0';
                    firstOperand = null;
                    operator = null;
                    awaitingNextInput = false;
                } else if (target.id === 'delete') {
                    deleteLastDigit();
                } else if (target.id === 'calculate') {
                    handleOperator(target.textContent);
                } else if (target.classList.contains('decimal')) {
                    inputDecimal();
                } else {
                    inputDigit(target.textContent);
                }

                display.value = currentInput;
            });

            toggleHistoryBtn.addEventListener('click', toggleHistory);

            loadHistory();
        });
    </script>
</body>
</html>
