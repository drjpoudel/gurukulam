<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Calculator with History</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f5f5f5;
        }
        .calculator-container {
            display: flex;
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            overflow: hidden; /* Ensure sidebar overflow is hidden */
        }
        .calculator {
            margin-right: 20px;
        }
        #display {
            width: 100%;
            padding: 10px;
            font-size: 1.5em;
            text-align: right;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .keys {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }
        .keys button {
            padding: 15px;
            font-size: 1.2em;
            border: none;
            background: #e0e0e0;
            cursor: pointer;
            border-radius: 5px;
        }
        .keys button.operator {
            background: #ff9800;
            color: #fff;
        }
        .keys button.special {
            background: #9c27b0;
            color: #fff;
        }
        .keys button.memory {
            background: #4caf50;
            color: #fff;
        }
        .keys button#clear, .keys button#delete {
            background: #f44336;
            color: #fff;
        }
        .keys button#calculate {
            background: #2196f3;
            color: #fff;
            grid-column: span 2;
        }
        .history {
            max-width: 200px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease-in-out; /* Smooth transition */
            transform: translateX(0); /* Initially show sidebar */
        }
        .history.collapsed {
            transform: translateX(-100%); /* Slide sidebar off-screen */
        }
        .history h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history h2 button {
            background: #f44336;
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .history h2 button:hover {
            background: #e53935;
        }
        .history-list {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
            overflow-y: auto;
            max-height: 400px;
        }
        .history-list li {
            background: #f0f0f0;
            margin-bottom: 5px;
            padding: 10px;
            border-radius: 5px;
            word-wrap: break-word;
        }
        .toggle-sidebar-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2196f3;
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none; /* Initially hidden on large screens */
        }
        .toggle-sidebar-btn.show {
            display: block; /* Show on small screens */
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator">
            <input type="text" id="display" readonly>
            <div class="keys">
                <button class="operator">+</button>
                <button class="operator">-</button>
                <button class="operator">*</button>
                <button class="operator">/</button>
                <button class="special">√</button>
                <button class="special">%</button>
                <button class="special">sin</button>
                <button class="special">cos</button>
                <button class="special">tan</button>
                <button class="special">log</button>
                <button class="special">ln</button>
                <button class="special">x!</button>
                <button class="memory">M+</button>
                <button class="memory">M-</button>
                <button class="memory">MR</button>
                <button class="memory">MC</button>
                <button id="clear">C</button>
                <button id="delete">⌫</button>
                <button>7</button>
                <button>8</button>
                <button>9</button>
                <button>4</button>
                <button>5</button>
                <button>6</button>
                <button>1</button>
                <button>2</button>
                <button>3</button>
                <button>0</button>
                <button class="decimal">.</button>
                <button id="calculate">=</button>
            </div>
        </div>
        <div class="history">
            <h2>History <button id="clear-history">Clear</button></h2>
            <ul class="history-list" id="history-list"></ul>
        </div>
    </div>
    <button class="toggle-sidebar-btn" id="toggle-sidebar-btn">Toggle History</button>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const display = document.getElementById('display');
            const keys = document.querySelector('.keys');
            const history = document.querySelector('.history');
            const historyList = document.getElementById('history-list');
            const clearHistoryBtn = document.getElementById('clear-history');
            const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
            let currentInput = '0';
            let firstOperand = null;
            let operator = null;
            let awaitingNextInput = false;
            let memory = 0;
            let historyData = [];

            function inputDigit(digit) {
                if (awaitingNextInput) {
                    currentInput = digit;
                    awaitingNextInput = false;
                } else {
                    currentInput = currentInput === '0' ? digit : currentInput + digit;
                }
            }

            function inputDecimal() {
                if (!currentInput.includes('.')) {
                    currentInput += '.';
                }
            }

            function deleteLastDigit() {
                currentInput = currentInput.slice(0, -1) || '0';
            }

            function handleOperator(nextOperator) {
                const inputValue = parseFloat(currentInput);
                if (operator && awaitingNextInput) {
                    operator = nextOperator;
                    return;
                }
                if (firstOperand === null) {
                    firstOperand = inputValue;
                } else if (operator) {
                    const result = performCalculation[operator](firstOperand, inputValue);
                    addToHistory(`${firstOperand} ${operator} ${inputValue} = ${result}`);
                    currentInput = String(result);
                    firstOperand = result;
                }
                operator = nextOperator;
                awaitingNextInput = true;
            }

            const performCalculation = {
                '+': (firstOperand, secondOperand) => firstOperand + secondOperand,
                '-': (firstOperand, secondOperand) => firstOperand - secondOperand,
                '*': (firstOperand, secondOperand) => firstOperand * secondOperand,
                '/': (firstOperand, secondOperand) => firstOperand / secondOperand,
                '√': (firstOperand) => Math.sqrt(firstOperand),
                '%': (firstOperand, secondOperand) => (firstOperand * secondOperand) / 100,
                '=': (firstOperand, secondOperand) => secondOperand,
                'sin': (firstOperand) => Math.sin(firstOperand),
                'cos': (firstOperand) => Math.cos(firstOperand),
                'tan': (firstOperand) => Math.tan(firstOperand),
                'log': (firstOperand) => Math.log10(firstOperand),
                'ln': (firstOperand) => Math.log(firstOperand),
                'x!': (firstOperand) => factorial(firstOperand),
                'M+': () => {
                    memory += parseFloat(currentInput);
                    return memory;
                },
                'M-': () => {
                    memory -= parseFloat(currentInput);
                    return memory;
                },
                'MR': () => memory,
                'MC': () => {
                    memory = 0;
                    return memory;
                }
            };

            function factorial(num) {
                if (num === 0 || num === 1) {
                    return 1;
                }
                for (let i = num - 1; i >= 1; i--) {
                    num *= i;
                }
                return num;
            }

            function resetCalculator() {
                currentInput = '0';
                firstOperand = null;
                operator = null;
                awaitingNextInput = false;
            }

            function addToHistory(entry) {
                historyData.push(entry);
                localStorage.setItem('calculatorHistory', JSON.stringify(historyData));
                updateHistory();
            }

            function loadHistory() {
                const storedHistory = JSON.parse(localStorage.getItem('calculatorHistory'));
                if (storedHistory) {
                    historyData = storedHistory;
                    updateHistory();
                }
            }

            function updateHistory() {
                historyList.innerHTML = historyData.map(entry => `<li>${entry}</li>`).join('');
            }

            function clearHistory() {
                historyData = [];
                localStorage.removeItem('calculatorHistory');
                updateHistory();
            }

            function toggleSidebar() {
                history.classList.toggle('collapsed');
            }

            keys.addEventListener('click', (event) => {
                const { target } = event;
                if (!target.matches('button')) {
                    return;
                }

                if (target.classList.contains('operator') || target.classList.contains('special') || target.classList.contains('memory')) {
                    handleOperator(target.textContent);
                } else if (target.id === 'clear') {
                    resetCalculator();
                } else if (target.id === 'delete') {
                    deleteLastDigit();
                } else if (target.id === 'calculate') {
                    handleOperator(target.textContent);
                } else if (target.classList.contains('decimal')) {
                    inputDecimal();
                } else {
                    inputDigit(target.textContent);
                }

                display.value = currentInput;
            });

            clearHistoryBtn.addEventListener('click', clearHistory);
            toggleSidebarBtn.addEventListener('click', toggleSidebar);

            loadHistory();
        });
    </script>
</body>
</html>
